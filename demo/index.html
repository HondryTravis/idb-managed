<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <title>Demo for idb-managed</title>
    </head>
    <body>
        <button onclick="addItems()">addItems</button>
        <button onclick="addItemsParallel()">addItemsParallel</button>
        <button onclick="getItem()">getItem</button>
        <button onclick="getItems()">getItems</button>
        <button onclick="deleteDB()">deleteDB</button>
        <button onclick="deleteItems()">deleteItems</button>
        <script src="./js/idb-managed.js"></script>
        <script>
            console.log(IDBM.idbIsSupported());
            const db = new IDBM.CustomDB({
                dbName: 'DEMO_DB',
                tables: {
                    table1: {
                        primaryKey: 'key1',
                        // indexList: [],
                        indexList: [{
                            indexName: 'value1',
                            unique: true
                        }],
                        itemDuration: 3000
                    },
                    table2: {
                        primaryKey: 'key2',
                        indexList: []
                    },
                    table3: {
                        indexList: []
                    }
                },
                dbVersion: 2,
                itemDuration: 5000
            });
            function addItems() {
                return db.addItems([
                    {
                        tableName: 'table1',
                        item: { key1: 'xixi', value1: new Date().getSeconds() },
                        itemDuration: 1000
                    },
                    {
                        tableName: 'table1',
                        item: { key1: 'haha', value1: '2' },
                        itemDuration: 1000 * 3600
                    },
                    {
                        tableName: 'table2',
                        item: { key2: 'xiuxiu', value2: 'lala' }
                    },
                    {
                        tableName: 'table3',
                        item: { value: new Date().getSeconds()},
                        itemDuration: 10 * 1000
                    }
                ])
                    .then(ob => {
                        console.log(ob);
                    })
                    .catch(e => {
                        console.log(e);
                    });
            }
            function addItemsParallel() {
                for (let i = 0; i < 10; i++) {
                    db.addItems([
                        {
                            tableName: 'table1',
                            item: { key1: 'key' + i, value1: 'value' + i}
                        }
                    ]);
                }
            }
            function getItem() {
                db.getItem('table1', 'xixi')
                    .then(ob => {
                        console.log(ob);
                    })
                    .catch(e => {
                        console.log(e);
                    });
            }
            function getItems() {
                db.getItemsInRange({
                    tableName: 'table3',
                    indexRange: {
                        indexName: 'id',
                        upperIndex: '2',
                        lowerExclusive: true,
                        upperExclusive: true,
                    }
                })
                    .then(ob => {
                        console.log(ob);
                    })
                    .catch(e => {
                        console.log(e);
                    });
            }
            function deleteItems() {
                // addItems()
                //     .then(() => {
                        db.deleteItemsInRange([
                            {
                                tableName: 'table1',
                                indexRange: {
                                    indexName: 'key1',
                                    lowerIndex: 'key6'
                                }
                            },
                            {
                                tableName: 'table3'
                            }
                        ])
                        .then(ob => {
                            console.log(ob);
                        })
                        .catch(e => {
                            console.log(e);
                        });
                    // })
            }
            function deleteDB() {
                IDBM.deleteDB('DEMO_DB')
                    .then(ob => {
                        console.log(ob);
                    })
                    .catch(e => {
                        console.log(e);
                    });
            }
        </script>
    </body>
</html>
